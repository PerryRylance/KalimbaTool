jQuery(function($) {
	
	function getTestMIDI()
	{
		// Create a file and track, push the track onto the file
		/*var file = new MIDIFile();
		
		var track = new MIDITrack();
		file.tracks.push(track);

		// Push some events onto the track
		var semitones=[0,1,2,3,4,5,6,7,8,9,10,11,12];
		
		var root = 60; // Middle C
		
		for(var i = 0; i < semitones.length; i++)
		{
			var e = new MIDIControlEvent(MIDIControlEvent.NOTE_ON, root + semitones[i], 127);
			
			if(i > 0)
				e.delta = file.timeDivision / 8;		// Space events out by one quarter note (crotchet) each
			
			track.events.push(e);
		}

		for(var i = 0; i < semitones.length; i++)
		{
			var e = new MIDIControlEvent(MIDIControlEvent.NOTE_OFF, root + semitones[i], 127);
			
			if(i == 0)
				e.delta = file.timeDivision * 4;	// Wait for one measure (bar) and then send all notes off
			
			track.events.push(e);
		}
		
		return file;*/
		
		var binary = atob(
		
		"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"
		/*"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N1qIAIA3AIIAkDlahgCAOQAAkDtahgCAOwAAkDxahACAPAAAkEFahgCAQQAAkEBaiACAQACCAJBFWoYAgEUAAJBHWoYAgEcAAJBIWoQAgEgAAJBFWoYAgEUAAJBDWogAgEMAggCQRVqGAIBFAACQR1qGAIBHAACQSFqEAIBIAACQTVqgAIBNAACQTFqgAIBMAACQNFqBAIA0AACQN1qBAIA3AACQOVmWAIA5AACQPFKCAIA8AACQO1GCAIA7AACQOVCCAIA5AACQN0+CAIA3AACQNU6eAIA1AACQNESBAIA0AACQNUSBAIA1AACQN0SYAIA3AACQPDuCAIA8AACQOzuCAIA7AACQOTqCAIA5AACQNzmCAIA3AACQNzieAIA3AIIAkEAtgQCAQAAAkEMtgQCAQwAAkEUslgCARQAAkEglggCASAAAkEckggCARwAAkEUjggCARQAAkEMiggCAQwAAkEEhngCAQQAAkEAXgQCAQAAAkEEXgQCAQQAAkEMXmACAQwAAkEgOggCASAAAkEcOggCARwAAkEUNggCARQAAkEMMggCAQwAAkEMLngCAQwCCAf8vAE1UcmsAAAJtAP8DEEJsb3duIEJvdHRsZSAoMikAwUwAkTRaoACBNAAAkTBaoACBMAAAkTRaoACBNAAAkS9aoACBLwAAkTRaoACBNAAAkTBaoACBMAAAkTRaoACBNAAAkS9aoACBLwAAkS1aoACBLQAAkS1aoACBLQAAkTBakACBMAAAkTVakACBNQAAkTxakACBPAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTxakACBPAAAkTVakACBNQAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTVakACBNQAAkTVakACBNQAAkTBakACBMAAAkTBakACBMAAAkTRaoACBNAAAkTBaoACBMAAAkTRaoACBNAAAkS9aoACBLwAAkTRaoACBNAAAkTBaoACBMAAAkTRaoACBNAAAkS9aoACBLwAAkS1aoACBLQAAkS1aoACBLQAAkTBakACBMAAAkTVakACBNQAAkTxakACBPAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTxakACBPAAAkTVakACBNQAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTBakACBMAAAkTVakACBNQAAkTVakACBNQAAkTVakACBNQAAkTBakACBMAAAkTBakACBMAAAkTRaoACBNAAAkTBOoACBMAAAkTREoACBNAAAkS84oACBLwAAkTQtoACBNAAAkTAhoACBMAAAkTQXoACBNAAAkS8LoACBLwAB/y8ATVRyawAAAm8A/wMSTGVhZCA4IChiYXNzK2xlYWQpAMJXAJIhUKAAgiEAAJIdUKAAgh0AAJIYUKAAghgAAJIfUKAAgh8AAJIhUKAAgiEAAJIdUKAAgh0AAJIYUKAAghgAAJIfUKAAgh8AAJIhUKAAgiEAAJIhUKAAgiEAAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIdUJAAgh0AAJIdUJAAgh0AAJIYUJAAghgAAJIYUJAAghgAAJIhUKAAgiEAAJIdUKAAgh0AAJIYUKAAghgAAJIfUKAAgh8AAJIhUKAAgiEAAJIdUKAAgh0AAJIYUKAAghgAAJIfUKAAgh8AAJIhUKAAgiEAAJIhUKAAgiEAAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIYUJAAghgAAJIdUJAAgh0AAJIdUJAAgh0AAJIdUJAAgh0AAJIYUJAAghgAAJIYUJAAghgAAJIhUKAAgiEAAJIdRqAAgh0AAJIYPKAAghgAAJIfMqAAgh8AAJIhKKAAgiEAAJIdHqAAgh0AAJIYFKAAghgAAJIfCqAAgh8AAf8vAE1UcmsAAAyzAP8DClRhaWtvIERydW0Aw3QAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCMAJM3UIIAgzcAAJM3UIIAgzcAjACTN1CCAIM3AACTN1CCAIM3AIwAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3UIIAgzcAAJM3UIIAgzcAhACTN1CCAIM3AACTN1CCAIM3AIQAkzdQggCDNwAAkzdQggCDNwCEAJM3ToIAgzcAAJM3ToIAgzcAhACTN0yCAIM3AACTN0uCAIM3AIQAkzdJggCDNwAAkzdJggCDNwCEAJM3RoIAgzcAAJM3RoIAgzcAhACTN0SCAIM3AACTN0OCAIM3AIQAkzdCggCDNwAAkzdBggCDNwCEAJM3P4IAgzcAAJM3PoIAgzcAhACTNz2CAIM3AACTNzyCAIM3AIQAkzc6ggCDNwAAkzc6ggCDNwCEAJM3OIIAgzcAAJM3N4IAgzcAhACTNzWCAIM3AACTNzWCAIM3AIQAkzcyggCDNwAAkzcyggCDNwCEAJM3MIIAgzcAAJM3L4IAgzcAhACTNy6CAIM3AACTNy2CAIM3AIQAkzcrggCDNwAAkzcqggCDNwCEAJM3KYIAgzcAAJM3KIIAgzcAhACTNyaCAIM3AACTNyaCAIM3AIQAkzckggCDNwAAkzcjggCDNwCEAJM3IYIAgzcAAJM3IYIAgzcAhACTNx6CAIM3AACTNx6CAIM3AIQAkzccggCDNwAAkzcbggCDNwCEAJM3GoIAgzcAAJM3GYIAgzcAhACTNxeCAIM3AACTNxaCAIM3AIQAkzcVggCDNwAAkzcUggCDNwCEAJM3EoIAgzcAAJM3EoIAgzcAhACTNxCCAIM3AACTNw+CAIM3AIQAkzcNggCDNwAAkzcNggCDNwCEAJM3CoIAgzcAAJM3CoIAgzcAhACTNwiCAIM3AACTNweCAIM3AIQAkzcGggCDNwAAkzcFggCDNwCEAJM3A4IAgzcAAJM3AoIAgzcAhACTNwGCAIM3AAH/LwA="*/
		
		);
		
		var length = binary.length;
		
		var bytes = new Uint8Array(length);
		
		for(var i = 0; i < length; i++)
			bytes[i] = binary.charCodeAt(i);
		
		var stream = new MIDIStream(bytes.buffer);
		
		var file = new MIDIFile();
		
		file.readBytes(stream);
		
		file.tracks.forEach(function(track) {
			
			track.events.forEach(function(event) {
				
				if(event instanceof MIDIControlEvent)
					event.pitch( event.pitch() + 12 );
				
			});
			
		});
		
		return file;
	}
	
	window.App = function()
	{
		var temp = getTestMIDI();
		
		this.kalimba	= new Kalimba($("#kalimba"));
		this.tracks		= new Tracks($("#tracks"));
		
		this.tracks.update(temp);
		this.tablature	= Tablature.fromMIDI($("#tablature"), this.kalimba, temp);
		
		
	}
	
	Object.defineProperty(window, "tablature", {
		get: function()
		{
			debugger;
		}
	});
	
	window.app = new App();
	
	
	
	
	
	$(window).on("load", function(event) {
	
		MIDI.loadPlugin({
			soundfontUrl: "lib/mudcube/MIDI.js-master/examples/soundfont/",
			instrument: "acoustic_grand_piano",
			onprogress: function(state, progress) {
				console.log(state, progress);
			},
			onsuccess: function() {
				
				$(document.body).on("click", function(event) {
					
					var midi	= getTestMIDI();
					var stream	= new MIDIStream();
					
					midi.writeBytes(stream);
					
					var base64	= stream.toDataURL();
					
					player = MIDI.Player;
					player.timeWarp = 2;
					player.loadFile(base64, player.start);
					
					player.setAnimation(function(data, element) {
						
						var percent = data.now / data.end;
						app.tablature.setProgress(percent);
						
					});
					
				});
			}
		});
		
	});
	
});